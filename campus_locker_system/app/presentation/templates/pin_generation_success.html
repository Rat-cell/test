{% extends "base.html" %}

{% block title %}PIN Generated Successfully - Campus Locker System{% endblock %}

{% block header_title %}✅ PIN Generated{% endblock %}

{% block navigation %}
<!-- No navigation for PIN generation success page -->
{% endblock %}

{% block content %}
<div class="card">
    <div class="text-center mb-6">
        <div style="font-size: 60px; color: var(--success-color); margin-bottom: 1rem;">✅</div>
        <h1 style="color: var(--success-color); margin-bottom: 0.5rem;">PIN Generated Successfully!</h1>
        <p>Your pickup PIN has been sent to your email</p>
    </div>
        
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flashes">
        {% for category, message in messages %}
          <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    
    <div class="alert alert--success mb-6">
        <h3>📧 Check Your Email Now</h3>
        <p style="margin-bottom: 1rem;">Your pickup PIN has been generated and sent to <strong>{{ parcel.recipient_email }}</strong></p>
        <div style="margin-bottom: 0.75rem;">
            <strong>Locker ID:</strong> {{ parcel.locker_id }}
        </div>
        <div style="margin-bottom: 0.75rem;">
            <strong>Parcel ID:</strong> {{ parcel.id }}
        </div>
        
        <div style="background-color: var(--bg-tertiary); padding: 0.75rem; border-radius: var(--radius-sm); margin-top: 1rem;">
            <strong>Generation Count:</strong> {{ parcel.pin_generation_count }}/3 (daily limit)
            {% if parcel.last_pin_generation %}
            <br><strong>Generated:</strong> {{ parcel.last_pin_generation.strftime('%Y-%m-%d %H:%M:%S') }} UTC
            {% endif %}
        </div>
    </div>

    <div class="alert alert--warning mb-6">
        <h3>⏰ Important Timing Information</h3>
        <ul style="margin: 0; padding-left: 1.5rem;">
            <li><strong>PIN Validity:</strong> Your PIN is valid for {{ pin_expiry_hours }} hours from generation</li>
            <li><strong>Email Delivery:</strong> Usually takes 1-2 minutes to arrive</li>
            <li><strong>Daily Limit:</strong> You can generate up to 3 PINs per day</li>
            <li><strong>Security:</strong> Each new PIN invalidates the previous one</li>
        </ul>
    </div>

    <div class="flex flex-col gap-4 mb-6">
        <a href="/pickup" class="btn btn--success btn--large">
            🔑 Go to Pickup Page
        </a>
        {% set remaining_attempts = 3 - parcel.pin_generation_count %}
        {% if remaining_attempts > 0 %}
        <a href="/request-new-pin" class="btn btn--warning btn--large">
            🔄 Generate Another PIN ({{ remaining_attempts }} attempt{{ 's' if remaining_attempts != 1 else '' }} left)
        </a>
        {% else %}
        <button class="btn btn--warning btn--large" disabled style="opacity: 0.5; cursor: not-allowed;">
            🔄 Daily Limit Reached (0 attempts left)
        </button>
        {% endif %}
    </div>

    <div class="alert alert--info">
        <h3>📧 Didn't receive the email?</h3>
        <ul style="margin: 0; padding-left: 1.5rem;">
            <li><strong>Check your spam/junk folder</strong> - automated emails sometimes end up there</li>
            <li><strong>Wait a few minutes</strong> - email delivery can take 1-5 minutes</li>
            <li><strong>Verify the email address</strong> - make sure it matches what was used during deposit</li>
            {% if parcel.pin_generation_count < 3 %}
            <li><strong>Generate a new PIN</strong> - you have {{ 3 - parcel.pin_generation_count }} attempts remaining today</li>
            {% else %}
            <li><strong>Daily limit reached</strong> - contact support or try again tomorrow</li>
            {% endif %}
        </ul>
    </div>

    <div class="text-center mt-6">
        <a href="/" class="btn btn--secondary">
            🏠 Back to Home
        </a>
    </div>
</div>
{% endblock %} 